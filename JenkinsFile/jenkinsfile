pipeline {
	agent any
		stages {
			//Properties File loading
			stage('Load Properties File') {
				steps {
					script {
						props = readProperties file: 'PropertiesFile/pipeline.properties'
						}
					}
			}

			//GIT Cloning
			stage('SCM Checkout') {
				steps {
					git url: props.GIT_URL,
					branch: props.BRANCH
					echo 'SCM Checkout Success'
					}
			}

			//Sonar Scanning
			stage('SonarQube Analysis') {
				steps {
					dir(props.PROJECT_PATH) {
						sh props.BUILD_SONAR_SCAN
						echo 'SoanrQube Analysis Success'
					}
				}
			}
			
			//Maven Building
			stage('Maven Build') {
				steps {
					dir(props.PROJECT_PATH) {
						sh props.MAVEN_BUILD
						echo 'Maven Build Success'
					}
				}
			}
			
			//Artifact Archiving and Uploading
			stage('Artifact Upload') {
				steps {
					script {
						server = Artifactory.server props.ARTIFACTORY_SERVER
						def uploadSpec = """{
							"files": [
	                    		{
	                    			"pattern": "target/*.war",
	                        		"target": "DevOps301Vishwesh/sampleWebApp/target/*.war"
	                        		echo "Artifact Archival Success"
	                    		}
	                    		]
	                		}"""
	                	server.upload(uploadSpec) 
              			echo "Artifact Upload Success"
	            	}
				}
			}	
			
			
		}
}
