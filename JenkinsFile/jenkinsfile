//PipelineScript

pipeline {
    
    agent any
    
    stages {
		stage('Properties Load') {
			steps {
				script {
					props = readProperties file: 'PropertiesFile/pipeline.properties'
					echo 'Properties file load Success'
				}
			}
		}
		
		stage('SCM Checkout') {
			steps {
				git url: props.GIT_URL,
                branch: props.BRANCH
				echo 'GIT SCM Checkout Success'
			}
		}
		
		stage('Maven Build') {
            steps {
				sh props.MAVEN_BUILD
				echo 'Maven build Success'
            }
		}
		
		stage('SonarQube Analysis') {
            steps {
				sh props.SONAR_SCAN+' '+props.SONAR_HOST
				echo 'SonarQube Ananlysis Success'
			}
        }        
		
		stage('Artifact Upload') {
            steps {
				script {
					server = Artifactory.server props.ARTIFACTORY_ID
					uploadSpec = """{
						"files":[{
							"pattern": "target/*.war",
							"target": "Jenkins-snapshot"
						}]
					}"""
				server.upload(uploadSpec) 	
				echo 'Artifact Upload Success'
				}
            }
		}
		
		stage('Deployment') {
            steps {
				sh props.TOMCAT_DEPLOY+' '+props.TOMCAT_LOCATION
				echo 'Deployment Success'
            }
		}
	}
}